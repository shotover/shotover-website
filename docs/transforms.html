<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Transforms | Shotover</title>
    <meta name="description" content="Shotover Description">
    <link rel="stylesheet" href="/shotover-blog/assets/style.d4430bd5.css">
    <link rel="modulepreload" href="/shotover-blog/assets/chunks/config.ddba8e9b.js">
    <link rel="modulepreload" href="/shotover-blog/assets/app.0afedf10.js">
    <link rel="modulepreload" href="/shotover-blog/assets/docs_transforms.md.3607c298.lean.js">
    
    <link rel="icon" type="image/x-icon" href="/shotover-blog/favicon.ico">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-f44a984a><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-f44a984a data-v-a50780ff><div class="VPNavBar has-sidebar" data-v-a50780ff data-v-6f1d18b5><div class="container" data-v-6f1d18b5><div class="VPNavBarTitle has-sidebar" data-v-6f1d18b5 data-v-d5925166><a class="title" href="/shotover-blog/" data-v-d5925166><!--[--><!--]--><!--[--><img class="VPImage logo" src="/shotover-blog/logo.png" alt data-v-b7ac6bd3><!--]--><!--[-->Shotover<!--]--><!--[--><!--]--></a></div><div class="content" data-v-6f1d18b5><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6f1d18b5 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/shotover-blog/docs/user-guide/introduction.html" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Docs<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/shotover-blog/blog/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Blog<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://github.com/shotover/shotover-proxy" target="_blank" rel="noreferrer" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Github<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6f1d18b5 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-a3e7452b data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6f1d18b5 data-v-e4361c82 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e4361c82><div class="item appearance" data-v-e4361c82><p class="label" data-v-e4361c82>Appearance</p><div class="appearance-action" data-v-e4361c82><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e4361c82 data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6f1d18b5 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-f44a984a data-v-b6162a8b><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b6162a8b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-b6162a8b><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-b6162a8b>Menu</span></button><a class="top-link" href="#" data-v-b6162a8b> Return to top </a></div><aside class="VPSidebar" data-v-f44a984a data-v-a186aa16><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-a186aa16><span class="visually-hidden" id="sidebar-aria-label" data-v-a186aa16> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-a186aa16><section class="VPSidebarGroup" data-v-a186aa16 data-v-6e45c352><div class="title" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>User Guide</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/shotover-blog/docs/user-guide/introduction.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Introduction</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/shotover-blog/docs/user-guide/getting-started.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Getting Started</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/shotover-blog/docs/user-guide/concepts.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Concepts</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/shotover-blog/docs/user-guide/configuration.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Configuration</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/shotover-blog/docs/user-guide/observability.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Observability</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup" data-v-a186aa16 data-v-6e45c352><!----><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/shotover-blog/docs/source-types.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Source Types</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup" data-v-a186aa16 data-v-6e45c352><!----><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link active" href="/shotover-blog/docs/transforms.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Transforms</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup" data-v-a186aa16 data-v-6e45c352><div class="title" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>Examples</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><span class="VPLink link" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Redis Cluster</span><!--]--><!----></span><!--[--><!--[--><a class="VPLink link link" href="/shotover-blog/docs/examples/redis-clustering-unaware.html" style="padding-left:16px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text light" data-v-36b976d1>Unaware client</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/shotover-blog/docs/examples/redis-clustering-aware.html" style="padding-left:16px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text light" data-v-36b976d1>Aware client</span><!--]--><!----></a><!----><!--]--><!--]--><!--]--><!--[--><span class="VPLink link" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Cassandra Cluster</span><!--]--><!----></span><!--[--><!--[--><a class="VPLink link link" href="/shotover-blog/docs/examples/cassandra-cluster-shotover-sidecar.html" style="padding-left:16px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text light" data-v-36b976d1>Shotover sidecars</span><!--]--><!----></a><!----><!--]--><!--]--><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup" data-v-a186aa16 data-v-6e45c352><!----><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/shotover-blog/docs/contributing.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Contributing</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-f44a984a data-v-d981fe29><div class="VPDoc has-sidebar has-aside" data-v-d981fe29 data-v-cfb513e0><div class="container" data-v-cfb513e0><div class="aside" data-v-cfb513e0><div class="aside-curtain" data-v-cfb513e0></div><div class="aside-container" data-v-cfb513e0><div class="aside-content" data-v-cfb513e0><div class="VPDocAside" data-v-cfb513e0 data-v-afc4c1a1><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-afc4c1a1 data-v-2865c0b0><div class="content" data-v-2865c0b0><div class="outline-marker" data-v-2865c0b0></div><div class="outline-title" data-v-2865c0b0>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-2865c0b0><span class="visually-hidden" id="doc-outline-aria-label" data-v-2865c0b0> Table of Contents for current page </span><ul class="root" data-v-2865c0b0 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-afc4c1a1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-cfb513e0><div class="content-container" data-v-cfb513e0><!--[--><!--]--><main class="main" data-v-cfb513e0><div style="position:relative;" class="vp-doc _shotover-blog_docs_transforms" data-v-cfb513e0><div><h1 id="transforms" tabindex="-1">Transforms <a class="header-anchor" href="#transforms" aria-hidden="true">#</a></h1><h2 id="concepts" tabindex="-1">Concepts <a class="header-anchor" href="#concepts" aria-hidden="true">#</a></h2><h3 id="sink" tabindex="-1">Sink <a class="header-anchor" href="#sink" aria-hidden="true">#</a></h3><p>Sink transforms send data out of Shotover to some other service. This is the opposite of Shotover&#39;s sources, although sources are not transforms.</p><h3 id="terminating" tabindex="-1">Terminating <a class="header-anchor" href="#terminating" aria-hidden="true">#</a></h3><p>Every transform chain must have exactly one terminating transform and it must be the final transform of the chain. This means that terminating transforms cannot pass messages onto another transform in the same chain. However some terminating transforms define their own sub-chains to allow further processing of messages.</p><h3 id="debug" tabindex="-1">Debug <a class="header-anchor" href="#debug" aria-hidden="true">#</a></h3><p>Debug transforms can be temporarily used to test how your Shotover configuration performs. Dont forget to remove them when you are finished.</p><h3 id="implementation-status" tabindex="-1">Implementation Status <a class="header-anchor" href="#implementation-status" aria-hidden="true">#</a></h3><ul><li>Alpha - Should not be used in production.</li><li>Beta - Ready for use but is not battle tested.</li><li>Ready - Ready for use.</li></ul><p>Future transforms won&#39;t be added to the public API while in alpha. But in these early days we have chosen to publish these alpha transforms to demonstrate the direction we want to take the project.</p><h2 id="transforms-1" tabindex="-1">Transforms <a class="header-anchor" href="#transforms-1" aria-hidden="true">#</a></h2><table><thead><tr><th>Transform</th><th>Terminating</th><th>Implementation Status</th></tr></thead><tbody><tr><td><a href="#cassandrasinkcluster">CassandraSinkCluster</a></td><td>✅</td><td>Beta</td></tr><tr><td><a href="#cassandrasinksingle">CassandraSinkSingle</a></td><td>✅</td><td>Alpha</td></tr><tr><td><a href="#cassandrapeersrewrite">CassandraPeersRewrite</a></td><td>❌</td><td>Alpha</td></tr><tr><td><a href="#coalesce">Coalesce</a></td><td>❌</td><td>Alpha</td></tr><tr><td><a href="#consistentscatter">ConsistentScatter</a></td><td>✅</td><td>Alpha</td></tr><tr><td><a href="#debugprinter">DebugPrinter</a></td><td>❌</td><td>Alpha</td></tr><tr><td><a href="#debugreturner">DebugReturner</a></td><td>✅</td><td>Alpha</td></tr><tr><td><a href="#null">Null</a></td><td>✅</td><td>Beta</td></tr><tr><td><a href="#parallelmap">ParallelMap</a></td><td>✅</td><td>Alpha</td></tr><tr><td><a href="#protect">Protect</a></td><td>❌</td><td>Alpha</td></tr><tr><td><a href="#querycounter">QueryCounter</a></td><td>❌</td><td>Alpha</td></tr><tr><td><a href="#querytypefilter">QueryTypeFilter</a></td><td>❌</td><td>Alpha</td></tr><tr><td><a href="#rediscache">RedisCache</a></td><td>❌</td><td>Alpha</td></tr><tr><td><a href="#redisclusterportsrewrite">RedisClusterPortsRewrite</a></td><td>❌</td><td>Beta</td></tr><tr><td><a href="#redissinkcluster">RedisSinkCluster</a></td><td>✅</td><td>Beta</td></tr><tr><td><a href="#redissinksingle">RedisSinkSingle</a></td><td>✅</td><td>Beta</td></tr><tr><td><a href="#redistimestamptagger">RedisTimestampTagger</a></td><td>❌</td><td>Alpha</td></tr><tr><td><a href="#tee">Tee</a></td><td>✅</td><td>Alpha</td></tr><tr><td><a href="#requestthrottling">RequestThrottling</a></td><td>❌</td><td>Alpha</td></tr></tbody></table><h3 id="cassandrasinkcluster" tabindex="-1">CassandraSinkCluster <a class="header-anchor" href="#cassandrasinkcluster" aria-hidden="true">#</a></h3><p>This transform will route Cassandra messages to a node within a Cassandra cluster based on:</p><ul><li>a configured <code>data_center</code> and <code>rack</code></li><li>token aware routing</li></ul><p>The fact that Shotover is routing to multiple destination nodes will be hidden from the client. Instead Shotover will pretend to be either a single Cassandra node or part of a cluster of Cassandra nodes consisting entirely of Shotover instances.</p><p>This is achieved by rewriting <code>system.local</code> and <code>system.peers</code>/<code>system.peers_v2</code> query results. The <code>system.local</code> will make Shotover appear to be its own node. While <code>system.peers</code>/<code>system.peers_v2</code> will be rewritten to list the configured Shotover peers as the only other nodes in the cluster.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki has-diff"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">CassandraSinkCluster</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># contact points must be within the configured data_center and rack.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># If this is not followed, Shotover will still function correctly but Shotover will communicate with a</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># node outside of the specified data_center and rack.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">first_contact_points</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.16.1.2:9042</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.16.1.3:9042</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># A list of every Shotover node that will be proxying to the same Cassandra cluster.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># This field should be identical for all Shotover nodes proxying to the same Cassandra cluster.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">shotover_nodes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># Address of the Shotover node.</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># This is usually the same address as the Shotover source that is connected to this sink.</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># But it may be different if you want Shotover to report a different address.</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">address</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:9042</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># The data_center this Shotover node will report as and route messages to.</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># For performance reasons, Shotover should be physically located in this data_center.</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">data_center</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dc1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># The rack this Shotover node will report as and route messages to.</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># For performance reasons, Shotover should be physically located in this rack.</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">rack</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rack1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># The host_id that Shotover will report as.</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># Does not affect message routing.</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># Make sure to set this to a unique value for each Shotover node, maybe copy one from: https://wasteaguid.info</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">host_id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2dd022d6-2937-4754-89d6-02d2933a8f7a</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;"># If you only have a single Shotover instance then you only want a single node.</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;"># Otherwise if you have multiple Shotover instances then add more nodes e.g.</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">#- address: &quot;127.0.0.2:9042&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">#  data_center: &quot;dc1&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">#  rack: &quot;rack2&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">#  host_id: &quot;3c3c4e2d-ba74-4f76-b52e-fb5bcee6a9f4&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">#- address: &quot;127.0.0.3:9042&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">#  data_center: &quot;dc2&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">#  rack: &quot;rack1&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">#  host_id: &quot;fa74d7ec-1223-472b-97de-04a32ccdb70b&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Defines which entry in shotover_nodes this Shotover instance will become.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># This affects:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># * the shotover_nodes data_center and rack fields are used for routing messages</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#     + Shotover will never route messages outside of the specified data_center</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#     + Shotover will always prefer to route messages to the specified rack</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#         but may route outside of the rack when nodes in the rack are unreachable</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># * which shotover_nodes entry is included in system.local and excluded from system.peers</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">local_shotover_host_id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2dd022d6-2937-4754-89d6-02d2933a8f7a</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Number of milliseconds to wait for a connection to be created to a destination cassandra instance.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># If the timeout is exceeded then connection to another node is attempted</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># If all known nodes have resulted in connection timeouts an error will be returned to the client.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">connect_timeout_ms</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># When this field is provided TLS is used when connecting to the remote address.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Removing this field will disable TLS.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#tls:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Path to the certificate authority file, typically named with a .crt extension.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  certificate_authority_path: &quot;tls/localhost_CA.crt&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Path to the certificate file, typically named with a .crt extension.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  certificate_path: &quot;tls/localhost.crt&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Path to the private key file, typically named with a .key extension.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  private_key_path: &quot;tls/localhost.key&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Enable/disable verifying the hostname of the certificate provided by the destination.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  #verify_hostname: true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># Timeout in seconds after which to give up waiting for a response from the destination.</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># This field is optional, if not provided, timeout will never occur.</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># When a timeout occurs the connection to the client is immediately closed.</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># read_timeout: 60</span></span>
<span class="line"></span></code></pre></div><h4 id="error-handling" tabindex="-1">Error handling <a class="header-anchor" href="#error-handling" aria-hidden="true">#</a></h4><p>If Shotover sends a request to a node and never gets a response, (maybe the node went down), Shotover will return a Cassandra <code>Server</code> error to the client. This is because the message may or may not have succeded, so only the client can attempt to retry as the retry may involve checking if the original query did in fact complete succesfully.</p><p>If no nodes are capable of receiving the query then Shotover will return a Cassandra <code>Overloaded</code> error indicating that the client should retry the query at some point.</p><p>All other connection errors will be handled internally by Shotover. And all Cassandra errors will be passed directly back to the client.</p><h4 id="metrics" tabindex="-1">Metrics <a class="header-anchor" href="#metrics" aria-hidden="true">#</a></h4><p>This transfrom emits a metrics <a href="./user-guide/observability.html#counter">counter</a> named <code>failed_requests</code> and the labels <code>transform</code> defined as <code>CassandraSinkCluster</code> and <code>chain</code> as the name of the chain that this transform is in.</p><h3 id="cassandrasinksingle" tabindex="-1">CassandraSinkSingle <a class="header-anchor" href="#cassandrasinksingle" aria-hidden="true">#</a></h3><p>This transform will send/receive Cassandra messages to a single Cassandra node. This will just pass the query directly to the remote node. No cluster discovery or routing occurs with this transform.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">CassandraSinkSingle</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># The IP address and port of the upstream Cassandra node/service.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">remote_address</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:9042</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Number of milliseconds to wait for a connection to be created to the destination cassandra instance.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># If the timeout is exceeded then an error is returned to the client.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">connect_timeout_ms</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># When this field is provided TLS is used when connecting to the remote address.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Removing this field will disable TLS.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#tls:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Path to the certificate authority file, typically named with a .crt extension.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  certificate_authority_path: &quot;tls/localhost_CA.crt&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Path to the certificate file, typically named with a .crt extension.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  certificate_path: &quot;tls/localhost.crt&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Path to the private key file, typically named with a .key extension.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  private_key_path: &quot;tls/localhost.key&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Enable/disable verifying the hostname of the certificate provided by the destination.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  #verify_hostname: true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># Timeout in seconds after which to give up waiting for a response from the destination.</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># This field is optional, if not provided, timeout will never occur.</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># When a timeout occurs the connection to the client is immediately closed.</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># read_timeout: 60</span></span>
<span class="line"></span></code></pre></div><p>This transfrom emits a metrics <a href="./user-guide/observability.html#counter">counter</a> named <code>failed_requests</code> and the labels <code>transform</code> defined as <code>CassandraSinkSingle</code> and <code>chain</code> as the name of the chain that this transform is in.</p><h3 id="cassandrapeersrewrite" tabindex="-1">CassandraPeersRewrite <a class="header-anchor" href="#cassandrapeersrewrite" aria-hidden="true">#</a></h3><p>This transform should be used with the <code>CassandraSinkSingle</code> transform. It will write over the ports of the peers returned by queries to the <code>system.peers_v2</code> table in Cassandra with a user supplied value (typically the port that Shotover is listening on so Cassandra drivers will connect to Shotover instead of the Cassandra nodes themselves).</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">CassandraPeersRewrite</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># rewrite the peer ports to 9043</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">9043</span></span>
<span class="line"></span></code></pre></div><h3 id="coalesce" tabindex="-1">Coalesce <a class="header-anchor" href="#coalesce" aria-hidden="true">#</a></h3><p>This transform holds onto messages until some requirement is met and then sends them batched together. Validation will fail if none of the <code>flush_when_</code> fields are provided, as this would otherwise result in a Coalesce transform that never flushes.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">Coalesce</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># When this field is provided a flush will occur when the specified number of messages are currently held in the buffer.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">flush_when_buffered_message_count</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># When this field is provided a flush will occur when the following occurs in sequence:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># 1. the specified number of milliseconds have passed since the last flush ocurred</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># 2. a new message is received</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">flush_when_millis_since_last_flush</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10000</span></span>
<span class="line"></span></code></pre></div><h3 id="consistentscatter" tabindex="-1">ConsistentScatter <a class="header-anchor" href="#consistentscatter" aria-hidden="true">#</a></h3><p>This transform implements a distributed eventual consistency mechanism between the set of defined sub-chains. This transform will wait for a user configurable number of chains to return an OK response before returning the value up-chain. This follows a similar model as used by Cassandra for its consistency model. Strong consistency can be achieved when W + R &gt; RF. In this case RF is always the number of chains in the <code>route_map</code>.</p><p>No sharding occurs within this transform and all requests/messages are sent to all routes.</p><p>Upon receiving the configured number of responses, the transform will attempt to resolve or unify the response based on metadata about the result. Currently it will try to return the newest response based on a metadata timestamp (last write wins) or it will simply return the largest response if no timestamp information is available.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">ConsistentScatter</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># The number of chains to wait for a &quot;write&quot; response on.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">write_consistency</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># The number of chains to wait for a &quot;read&quot; response on.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">read_consistency</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># A map of named chains. All chains will be used in each request.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">route_map</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">instance1</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">CassandraSinkSingle</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">remote_address</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:9043</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">instance2</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">CassandraSinkSingle</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">remote_address</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.1.0.2:9043</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">instance3</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">CassandraSinkSingle</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">remote_address</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.2.0.3:9043</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><h3 id="debugprinter" tabindex="-1">DebugPrinter <a class="header-anchor" href="#debugprinter" aria-hidden="true">#</a></h3><p>This transform will log the query/message at an info level, then call the down-chain transform.</p><div class="language-YAML"><button title="Copy Code" class="copy"></button><span class="lang">YAML</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">DebugPrinter</span></span>
<span class="line"></span></code></pre></div><h3 id="debugreturner" tabindex="-1">DebugReturner <a class="header-anchor" href="#debugreturner" aria-hidden="true">#</a></h3><p>This transform will drop any messages it receives and return the supplied response.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">DebugReturner</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># return a Redis response</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Redis</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">42</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># To intentionally fail, use this variant </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Fail</span></span>
<span class="line"></span></code></pre></div><h3 id="null" tabindex="-1">Null <a class="header-anchor" href="#null" aria-hidden="true">#</a></h3><p>This transform will drop any messages it receives and return an empty response.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">Null</span></span>
<span class="line"></span></code></pre></div><h3 id="parallelmap" tabindex="-1">ParallelMap <a class="header-anchor" href="#parallelmap" aria-hidden="true">#</a></h3><p>This transform will send messages in a single batch in parallel across multiple instances of the chain.</p><p>If we have a parallelism of 3 then we would have 3 instances of the chain: C1, C2, C3. If the batch then contains messages M1, M2, M3, M4. Then the messages would be sent as follows:</p><ul><li>M1 would be sent to C1</li><li>M2 would be sent to C2</li><li>M3 would be sent to C3</li><li>M4 would be sent to C1</li></ul><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">ParallelMap</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Number of duplicate chains to send messages through.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">parallelism</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># if true then responses will be returned in the same as order as the queries went out.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># if it is false then response may return in any order.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ordered_results</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># The chain that messages are sent through</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">chain</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">QueryCounter</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DR chain</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">RedisSinkSingle</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">remote_address</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:6379</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">connect_timeout_ms</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3000</span></span>
<span class="line"></span></code></pre></div><h3 id="protect" tabindex="-1">Protect <a class="header-anchor" href="#protect" aria-hidden="true">#</a></h3><p>This transform will encrypt specific fields before passing them down-chain, it will also decrypt those same fields from a response. The transform will create a data encryption key on an user defined basis (e.g. per primary key, per value, per table etc).</p><p>The data encryption key is encrypted by a key encryption key and persisted alongside the encrypted value (alongside other needed cryptographic material). This transform provides the basis for in-application cryptography with unified key management between datastores. The encrypted value is serialised using bincode and should then be written to a blob field by a down-chain transform.</p><p>Fields are protected using ChaCha20-Poly1305. Modification of the field is also detected and raised as an error. DEK protection is dependent on the key manager being used.</p><h4 id="local" tabindex="-1">Local <a class="header-anchor" href="#local" aria-hidden="true">#</a></h4><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">Protect</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># A key_manager config that configures the protect transform with how to look up keys.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">key_manager</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">Local</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">kek</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Ht8M1nDO/7fay+cft71M2Xy7j30EnLAsA84hSUMCm1k=</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">kek_id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># A mapping of keyspaces, tables and columns to encrypt.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">keyspace_table_columns</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">test_protect_keyspace</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">test_table</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">col1</span></span>
<span class="line"></span></code></pre></div><h4 id="aws" tabindex="-1">AWS <a class="header-anchor" href="#aws" aria-hidden="true">#</a></h4><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">Protect</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># A key_manager config that configures the protect transform with how to look up keys.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">key_manager</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">AWSKms</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">endpoint</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://localhost:5000</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">region</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">us-east-1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">cmk_id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">alias/aws/secretsmanager</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">number_of_bytes</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">32</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># A mapping of keyspaces, tables and columns to encrypt.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">keyspace_table_columns</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">test_protect_keyspace</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">test_table</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">col1</span></span>
<span class="line"></span></code></pre></div><p>Note: Currently the data encryption key ID function is just defined as a static string, this will be replaced by a user defined script shortly.</p><h3 id="querycounter" tabindex="-1">QueryCounter <a class="header-anchor" href="#querycounter" aria-hidden="true">#</a></h3><p>This transform will log the queries that pass through it. The log can be accessed via the <a href="./user-guide/configuration.html#observability_interface">Shotover metrics</a></p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">QueryCounter</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># this name will be logged with the query count</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DR chain</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>This transform emits a metrics <a href="./user-guide/observability.html#counter">counter</a> named <code>query_count</code> with the label <code>name</code> defined as the name from the config, in the example it will be <code>DR chain</code>.</p><h3 id="querytypefilter" tabindex="-1">QueryTypeFilter <a class="header-anchor" href="#querytypefilter" aria-hidden="true">#</a></h3><p>This transform will drop messages that match the specified filter.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">QueryTypeFilter</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># drop messages that are read</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Read</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># alternatively:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># drop messages that are write</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># filter: Write</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># drop messages that are read write</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># filter: ReadWrite</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># drop messages that are schema changes</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># filter: SchemaChange</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># drop messages that are pub sub messages</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># filter: PubSubMessage</span></span>
<span class="line"></span></code></pre></div><h3 id="rediscache" tabindex="-1">RedisCache <a class="header-anchor" href="#rediscache" aria-hidden="true">#</a></h3><p>This transform will attempt to cache values for a given primary key in a Redis hash set. It is a primarily implemented as a read behind cache. It currently expects an SQL based AST to figure out what to cache (e.g. CQL, PGSQL) and updates to the cache and the backing datastore are performed sequentially.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">RedisCache</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">caching_schema</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">test</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">partition_key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">test</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">range_key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">test</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">chain</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;"># The chain can contain anything but must end in a Redis sink</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">RedisSinkSingle</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;"># The IP address and port of the upstream redis node/service.</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">remote_address</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:6379</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">connect_timeout_ms</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3000</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="redisclusterportsrewrite" tabindex="-1">RedisClusterPortsRewrite <a class="header-anchor" href="#redisclusterportsrewrite" aria-hidden="true">#</a></h3><p>This transform should be used with the <code>RedisSinkCluster</code> transform. It will write over the ports of the nodes returned by <code>CLUSTER SLOTS</code> or <code>CLUSTER NODES</code> with a user supplied value (typically the port that Shotover is listening on so cluster aware Redis drivers will direct traffic through Shotover instead of the nodes themselves).</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">RedisClusterPortsRewrite</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># rewrite the ports returned by `CLUSTER SLOTS` and `CLUSTER NODES` to use this port.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">new_port</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6380</span></span>
<span class="line"></span></code></pre></div><h3 id="redissinkcluster" tabindex="-1">RedisSinkCluster <a class="header-anchor" href="#redissinkcluster" aria-hidden="true">#</a></h3><p>This transform is a full featured Redis driver that will connect to a Redis cluster and handle all discovery, sharding and routing operations.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">RedisSinkCluster</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># A list of IP address and ports of the upstream redis nodes/services.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">first_contact_points</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:2220</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:2221</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:2222</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:2223</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:2224</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:2225</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># By default RedisSinkCluster will attempt to emulate a single non-clustered redis node by completely hiding the fact that redis is a cluster.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># However, when this field is provided, this cluster hiding is disabled.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Instead other nodes in the cluster will only be accessed when performing a command that accesses a slot.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># All other commands will be passed directly to the direct_connection node.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># direct_connection: &quot;127.0.0.1:2220&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># The number of connections in the connection pool for each node.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># e.g. if connection_count is 4 and there are 4 nodes there will be a total of 16 connections.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># When this field is not provided connection_count defaults to 1.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">connection_count</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Number of milliseconds to wait for a connection to be created to a destination redis instance.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># If the timeout is exceeded then connection to another node is attempted</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># If all known nodes have resulted in connection timeouts an error will be returned to the client.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">connect_timeout_ms</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># When this field is provided TLS is used when connecting to the remote address.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Removing this field will disable TLS.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#tls:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Path to the certificate authority file, typically named ca.crt.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  certificate_authority_path: &quot;tls/ca.crt&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Path to the certificate file, typically named with a .crt extension.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  certificate_path: &quot;tls/redis.crt&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Path to the private key file, typically named with a .key extension.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  private_key_path: &quot;tls/redis.key&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Enable/disable verifying the hostname of the certificate provided by the destination.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  #verify_hostname: true</span></span>
<span class="line"></span></code></pre></div><p>Unlike other Redis cluster drivers, this transform does support pipelining. It does however turn each command from the pipeline into a group of requests split between the master Redis node that owns them, buffering results as within different Redis nodes as needed. This is done sequentially and there is room to make this transform split requests between master nodes in a more concurrent manner.</p><p>Latency and throughput will be different from pipelining with a single Redis node, but not by much.</p><p>This transfrom emits a metrics <a href="./user-guide/observability.html#counter">counter</a> named <code>failed_requests</code> and the labels <code>transform</code> defined as <code>RedisSinkCluster</code> and <code>chain</code> as the name of the chain that this transform is in.</p><h4 id="differences-to-real-redis" tabindex="-1">Differences to real Redis <a class="header-anchor" href="#differences-to-real-redis" aria-hidden="true">#</a></h4><p>On an existing authenticated connection, a failed auth attempt will not &quot;unauthenticate&quot; the user. This behaviour matches Redis 6 but is different to Redis 5.</p><h4 id="completeness" tabindex="-1">Completeness <a class="header-anchor" href="#completeness" aria-hidden="true">#</a></h4><p><em>Note: Currently RedisSinkcluster does not support the following functionality:</em></p><ul><li><em>Redis Transactions</em></li><li><em>Scan based operations e.g. SSCAN</em></li></ul><h3 id="redissinksingle" tabindex="-1">RedisSinkSingle <a class="header-anchor" href="#redissinksingle" aria-hidden="true">#</a></h3><p>This transform will take a query, serialise it into a RESP2 compatible format and send to the Redis compatible database at the defined address.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">RedisSinkSingle</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># The IP address and port of the upstream redis node/service.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">remote_address</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:6379</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Number of milliseconds to wait for a connection to be created to the destination redis instance.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># If the timeout is exceeded then an error is returned to the client.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">connect_timeout_ms</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># When this field is provided TLS is used when connecting to the remote address.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Removing this field will disable TLS.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#tls:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Path to the certificate authority file, typically named ca.crt.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  certificate_authority_path: &quot;tls/ca.crt&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Path to the certificate file, typically named with a .crt extension.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  certificate_path: &quot;tls/redis.crt&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Path to the private key file, typically named with a .key extension.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  private_key_path: &quot;tls/redis.key&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  # Enable/disable verifying the hostname of the certificate provided by the destination.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#  #verify_hostname: true</span></span>
<span class="line"></span></code></pre></div><p>Note: this will just pass the query to the remote node. No cluster discovery or routing occurs with this transform.</p><p>This transfrom emits a metrics <a href="./user-guide/observability.html#counter">counter</a> named <code>failed_requests</code> and the labels <code>transform</code> defined as <code>RedisSinkSingle</code> and <code>chain</code> as the name of the chain that this transform is in.</p><h3 id="redistimestamptagger" tabindex="-1">RedisTimestampTagger <a class="header-anchor" href="#redistimestamptagger" aria-hidden="true">#</a></h3><p>A transform that wraps each Redis command in a Lua script that also fetches the key for the operations idletime. This is then used to build a last modified timestamp and insert it into a response&#39;s timestamp. The response from the Lua operation is unwrapped and returned to up-chain transforms looking like a normal Redis response.</p><p>This is mainly used in conjunction with the <code>ConsistentScatter</code> transform to enable a Cassandra style consistency model within Redis.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">RedisTimestampTagger</span></span>
<span class="line"></span></code></pre></div><h3 id="tee" tabindex="-1">Tee <a class="header-anchor" href="#tee" aria-hidden="true">#</a></h3><p>This transform sends messages to both the defined sub chain and the remaining down-chain transforms. The response from the down-chain transform is returned back up-chain but various behaviours can be defined by the <code>behaviour</code> field to handle the case when the responses from the sub chain and down-chain do not match.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">Tee</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Ignore responses returned by the sub chain</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">behavior</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Ignore</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Alternatively:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># If the responses returned by the sub chain do not equal the responses returned by down-chain then return an error.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># behavior: FailOnMismatch</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># If the responses returned by the sub chain do not equal the responses returned by down-chain,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># then the original message is also sent down the SubchainOnMismatch sub chain.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># This is useful for logging failed messages.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># behavior: </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#   SubchainOnMismatch:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#     - QueryTypeFilter:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#         filter: Read</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#     - Null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># Timeout for sending to the sub chain in microseconds</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">timeout_micros</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># The number of message batches that the tee can hold onto in its buffer of messages to send.</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># If they arent sent quickly enough and the buffer is full then tee will drop new incoming messages.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">buffer_size</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10000</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># The sub chain to send duplicate messages through</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">chain</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">QueryTypeFilter</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Read</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">Null</span></span>
<span class="line"></span></code></pre></div><p>This transfrom emits a metrics <a href="./user-guide/observability.html#counter">counter</a> named <code>tee_dropped_messages</code> and the label <code>chain</code> as <code>Tee</code>.</p><h3 id="requestthrottling" tabindex="-1">RequestThrottling <a class="header-anchor" href="#requestthrottling" aria-hidden="true">#</a></h3><p>This transform will backpressure requests to Shotover, ensuring that throughput does not exceed the <code>max_requests_per_second</code> value.<code>max_requests_per_second</code> has a minimum allowed value of 50 to ensure that drivers such as Cassandra are able to complete their startup procedure correctly. In Shotover, a &quot;request&quot; is counted as a query/statement to upstream service. In Cassandra, the list of queries in a BATCH statement are each counted as individual queries. It uses a <a href="https://en.wikipedia.org/wiki/Generic_cell_rate_algorithm" target="_blank" rel="noreferrer">Generic Cell Rate Algorithm</a>.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">RequestThrottling</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">max_requests_per_second</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20000</span></span>
<span class="line"></span></code></pre></div><!----></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-cfb513e0 data-v-21f75714><!----><div class="prev-next" data-v-21f75714><div class="pager" data-v-21f75714><a class="pager-link prev" href="/shotover-blog/docs/source-types.html" data-v-21f75714><span class="desc" data-v-21f75714>Previous page</span><span class="title" data-v-21f75714>Source Types</span></a></div><div class="has-prev pager" data-v-21f75714><a class="pager-link next" href="/shotover-blog/docs/examples/redis-clustering-unaware.html" data-v-21f75714><span class="desc" data-v-21f75714>Next page</span><span class="title" data-v-21f75714>Unaware client</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"blog_index.md\":\"98fbfcc5\",\"blog_posts_example1.md\":\"bb088cad\",\"blog_posts_example2.md\":\"288664ba\",\"contacts.md\":\"9c233c3d\",\"docs_contributing.md\":\"1f708d15\",\"docs_examples_cassandra-cluster-shotover-sidecar.md\":\"817b9163\",\"docs_examples_redis-clustering-aware.md\":\"36291b3c\",\"docs_examples_redis-clustering-unaware.md\":\"f5b9aacc\",\"docs_source-types.md\":\"d51f3ed9\",\"docs_transforms.md\":\"3607c298\",\"docs_user-guide_concepts.md\":\"284d023f\",\"docs_user-guide_configuration.md\":\"d59668ad\",\"docs_user-guide_deployment.md\":\"69678674\",\"docs_user-guide_getting-started.md\":\"c5586426\",\"docs_user-guide_introduction.md\":\"cfa90d95\",\"docs_user-guide_observability.md\":\"e038e1a3\",\"index.md\":\"051b1982\"}")</script>
    <script type="module" async src="/shotover-blog/assets/app.0afedf10.js"></script>
    
  </body>
</html>